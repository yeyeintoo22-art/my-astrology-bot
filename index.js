const http = require('http');
const port = process.env.PORT || 3000;
http.createServer((req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/plain' });
    res.end('Bot is running!\n');
}).listen(port, () => {
    console.log(Server is running on port ${port}`);
    });
    
const { Telegraf } = require('telegraf');
const { DateTime } = require('luxon');

// âš ï¸ á€’á€®á€”á€±á€›á€¬á€™á€¾á€¬ á€á€„á€·á€ºá€›á€²á€· Bot Token á€€á€­á€¯ á€á€±á€á€»á€¬á€‘á€Šá€·á€ºá€•á€«
const bot = new Telegraf('8040160587:AAFOOF955wdafPXk-QFD4ApwVjhWKCQuS-0');

const PLANETS = { 1: "á€á€”á€„á€ºá€¹á€‚á€”á€½á€±", 2: "á€á€”á€„á€ºá€¹á€œá€¬", 3: "á€¡á€„á€ºá€¹á€‚á€«", 4: "á€—á€¯á€’á€¹á€“á€Ÿá€°á€¸", 5: "á€€á€¼á€¬á€á€•á€á€±á€¸", 6: "á€á€±á€¬á€€á€¼á€¬", 0: "á€…á€”á€±" };
const HOUSES = ["á€˜á€„á€ºá€¹á€‚", "á€¡á€‘á€½á€”á€ºá€¸", "á€á€­á€¯á€€á€º", "á€›á€¬á€‡", "á€™á€›á€", "á€¡á€“á€­á€•á€á€­", "á€•á€¯á€á€­"];
const SEQUENCE = [1, 2, 3, 4, 5, 6, 0];

// á€¡á€­á€™á€ºá€¡á€œá€­á€¯á€€á€º á€šá€á€¼á€¬á€”á€¾á€„á€·á€º á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€ºá€™á€»á€¬á€¸
const ADVICE = {
    "á€˜á€„á€ºá€¹á€‚": "ğŸ”„ á€¡á€•á€¼á€±á€¬á€„á€ºá€¸á€¡á€œá€²á€™á€»á€¬á€¸á€™á€Šá€ºá‹ á€á€›á€®á€¸á€á€±á€¸á€á€½á€¬á€¸á€›á€”á€ºá€›á€¾á€­á€€ á€á€á€­á€•á€¼á€¯á€•á€«á‹ á€šá€á€¼á€¬ - á€˜á€¯á€›á€¬á€¸á€á€½á€„á€º á€á€±á€¬á€€á€ºá€á€±á€¬á€ºá€›á€± (á‡) á€á€½á€€á€º á€€á€•á€ºá€œá€¾á€°á€•á€«á‹",
    "á€¡á€‘á€½á€”á€ºá€¸": "ğŸŒŸ á€‘á€½á€”á€ºá€¸á€€á€¬á€¸á€™á€Šá€·á€ºá€¡á€á€»á€­á€”á€ºá€–á€¼á€…á€ºá€á€Šá€ºá‹ á€¡á€€á€¼á€¶á€¡á€…á€Šá€ºá€á€…á€ºá€™á€»á€¬á€¸ á€…á€á€„á€ºá€•á€«á‹ á€šá€á€¼á€¬ - á€¡á€±á€¬á€„á€ºá€á€•á€¼á€± (áá) á€Šá€½á€”á€·á€º á€˜á€¯á€›á€¬á€¸á€œá€¾á€°á€•á€«á‹",
    "á€á€­á€¯á€€á€º": "ğŸ’° á€œá€¬á€˜á€ºá€›á€½á€¾á€„á€ºá€™á€Šá€ºá‹ á€„á€½á€±á€€á€¼á€±á€¸á€…á€¯á€†á€±á€¬á€„á€ºá€¸á€•á€«á‹ á€šá€á€¼á€¬ - á€á€€á€ºá€€á€¼á€®á€¸á€›á€½á€šá€ºá€¡á€­á€¯á€á€…á€ºá€¦á€¸á€¡á€¬á€¸ á€†á€±á€¸á€’á€«á€”á€•á€¼á€¯á€•á€«á‹",
    "á€›á€¬á€‡": "ğŸ‘‘ á€¡á€€á€¼á€®á€¸á€¡á€€á€² á€™á€…á€™á€Šá€ºá‹ á€¡á€œá€¯á€•á€ºá€á€½á€„á€º á€”á€±á€›á€¬á€›á€™á€Šá€ºá‹ á€šá€á€¼á€¬ - á€¡á€¯á€”á€ºá€¸á€”á€­á€¯á€†á€½á€™á€ºá€¸ á€€á€•á€ºá€œá€¾á€°á€•á€«á‹",
    "á€™á€›á€": "âš ï¸ á€˜á€±á€¸á€¥á€•á€«á€’á€º á€á€á€­á€‘á€¬á€¸á€•á€«á‹ á€¡á€™á€¾á€¯á€¡á€á€„á€ºá€¸ á€™á€–á€¼á€…á€ºá€…á€±á€›á€”á€º á€†á€„á€ºá€á€¼á€„á€ºá€•á€«á‹ á€šá€á€¼á€¬ - á€„á€«á€¸á€œá€½á€¾á€á€ºá€•á€±á€¸á€•á€«á‹",
    "á€¡á€“á€­á€•á€á€­": "ğŸ” á€™á€­á€™á€­á€¡á€œá€­á€¯á€›á€¾á€­á€›á€¬ á€–á€¼á€…á€ºá€‘á€½á€”á€ºá€¸á€™á€Šá€ºá‹ á€šá€á€¼á€¬ - á€¡á€™á€½á€¾á€±á€¸á€”á€¶á€·á€á€¬á€á€­á€¯á€„á€º (áá‰) á€á€­á€¯á€„á€º á€‘á€½á€”á€ºá€¸á€Šá€¾á€­á€•á€«á‹",
    "á€•á€¯á€á€­": "ğŸŒ«ï¸ á€¡á€á€„á€ºá€¸á€¡á€–á€»á€„á€ºá€¸á€”á€¾á€„á€·á€º á€¡á€•á€¯á€•á€ºá€¡á€…á€•á€º á€á€á€­á€‘á€¬á€¸á€•á€«á‹ á€šá€á€¼á€¬ - á€á€”á€·á€ºá€›á€¾á€„á€ºá€¸á€›á€±á€¸á€€á€¯á€á€­á€¯á€œá€º á€•á€¼á€¯á€œá€¯á€•á€ºá€•á€«á‹"
};


function nameToDigit(name) {
    const char = name.trim().charAt(0);
    const map = {
        'á€€': 2, 'á€': 2, 'á€‚': 2, 'á€ƒ': 2, 'á€„': 2,
        'á€…': 3, 'á€†': 3, 'á€‡': 3, 'á€ˆ': 3, 'á€Š': 3,
        'á€': 0, 'á€‘': 0, 'á€’': 0, 'á€“': 0, 'á€”': 0,
        'á€•': 5, 'á€–': 5, 'á€—': 5, 'á€˜': 5, 'á€™': 5,
        'á€š': 4, 'á€›': 4, 'á€œ': 4, 'á€': 4,
        'á€': 6, 'á€Ÿ': 6, 'á€¡': 1
    };
    return map[char] || 1; 
}
function getCurrentAkhar() {
    const now = DateTime.now().setZone('Asia/Yangon');
    const dayMap = { 1: 2, 2: 3, 3: 4, 4: 5, 5: 6, 6: 0, 7: 1 };
    const dayPlanet = dayMap[now.weekday];
    const hour = now.hour;
    let period = (hour >= 6 && hour < 18) ? Math.floor((hour - 6) / 3) : Math.floor((hour < 6 ? hour : hour - 18) / 3);
    const startIdx = SEQUENCE.indexOf(dayPlanet);
    return SEQUENCE[(startIdx + (period * 3)) % 7];
}

bot.start((ctx) => {
    ctx.reply("ğŸ”® á€—á€±á€’á€„á€º Bot á€™á€¾ á€€á€¼á€­á€¯á€†á€­á€¯á€•á€«á€á€šá€ºá‹\n\ná€á€½á€€á€ºá€á€»á€€á€ºá€›á€”á€º: /predict <á€¡á€„á€ºá€¹á€‚á€œá€­á€•á€ºá€”á€¾á€…á€º> <á€”á€¬á€™á€Šá€º>\ná€¥á€•á€™á€¬: /predict 1995 á€€á€»á€±á€¬á€ºá€€á€»á€±á€¬á€º");
});

bot.command('predict', (ctx) => {
    const args = ctx.message.text.split(' ');
    if (args.length < 3) return ctx.reply("âŒ á€•á€¯á€¶á€…á€¶á€™á€¾á€¬á€¸á€”á€±á€•á€«á€á€Šá€ºá‹ á€¥á€•á€™á€¬- /predict 1995 á€€á€»á€±á€¬á€ºá€€á€»á€±á€¬á€º");

    const eYear = parseInt(args[1]);
    const name = args[2];
    const dayNum = nameToDigit(name);
    const mYear = eYear - 638;

    const mHouse = HOUSES[(dayNum - (mYear % 7) + 7) % 7];
    const akhar = getCurrentAkhar();
    const aHouse = HOUSES[(SEQUENCE.indexOf(akhar) - SEQUENCE.indexOf(dayNum) + 7) % 7];

    let res = "ğŸ”® á€Ÿá€±á€¬á€…á€á€™á€ºá€¸\n\n";
    res += "ğŸ‘¤ á€¡á€™á€±á€¸á€›á€¾á€„á€º: " + name + " (" + PLANETS[dayNum] + "á€á€¬á€¸á€á€™á€®á€¸)\n";
    res += "ğŸ“… á€™á€¼á€”á€ºá€™á€¬á€”á€¾á€…á€º: " + mYear + "\n";
    res += "ğŸ§¬ á€™á€Ÿá€¬á€˜á€¯á€á€º: " + mHouse + " á€Œá€¬á€”á€–á€½á€¬á€¸\n";
    res += "ğŸ•’ á€œá€€á€ºá€›á€¾á€­á€¡á€á€«: " + PLANETS[akhar] + " (" + aHouse + " á€¡á€­á€™á€º)\n\n";
    res += "ğŸ’¡ á€”á€­á€‚á€¯á€¶á€¸: " + (["á€™á€›á€", "á€•á€¯á€á€­"].includes(aHouse) ? "âš ï¸ á€¡á€Šá€¶á€·á€›á€¾á€­á€á€–á€¼á€„á€·á€º á€á€á€­á€‘á€¬á€¸á€•á€«á‹" : "ğŸŒŸ á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€™á€Šá€·á€º á€€á€¬á€œá€–á€¼á€…á€ºá€á€Šá€ºá‹");
    res += "âœ¨ á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€º: " + ADVICE[aHouse];

    ctx.reply(res);
});


bot.launch().then(() => console.log("âœ… Bot is running successfully!"));

